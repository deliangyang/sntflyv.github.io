import{_ as s,c as n,o as a,a as l}from"./app.0ce55433.js";const D=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[{"level":2,"title":"mpas \u7C7B\u578B","slug":"mpas-\u7C7B\u578B","link":"#mpas-\u7C7B\u578B","children":[]},{"level":2,"title":"\u5B9A\u4E49\u4E00\u4E2A maps","slug":"\u5B9A\u4E49\u4E00\u4E2A-maps","link":"#\u5B9A\u4E49\u4E00\u4E2A-maps","children":[]},{"level":2,"title":"\u76F8\u5173\u51FD\u6570","slug":"\u76F8\u5173\u51FD\u6570","link":"#\u76F8\u5173\u51FD\u6570","children":[]},{"level":2,"title":"\u904D\u5386 maps","slug":"\u904D\u5386-maps","link":"#\u904D\u5386-maps","children":[]},{"level":2,"title":"\u53C2\u8003","slug":"\u53C2\u8003","link":"#\u53C2\u8003","children":[]}],"relativePath":"t/Linux/\u52A8\u6001\u8FFD\u8E2A\u6280\u672F/ebpf-\u6570\u636E\u7ED3\u6784\u4ECB\u7ECD.md","lastUpdated":1729589704000}'),e={name:"t/Linux/\u52A8\u6001\u8FFD\u8E2A\u6280\u672F/ebpf-\u6570\u636E\u7ED3\u6784\u4ECB\u7ECD.md"},t=l(`<h2 id="mpas-\u7C7B\u578B" tabindex="-1">mpas \u7C7B\u578B <a class="header-anchor" href="#mpas-\u7C7B\u578B" aria-hidden="true">#</a></h2><table><thead><tr><th style="text-align:center;">\u7C7B\u578B\u540D\u79F0</th><th style="text-align:center;">\u89E3\u91CA</th></tr></thead><tbody><tr><td style="text-align:center;">BPF_MAP_TYPE_ARRAY</td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;">BPF_MAP_TYPE_PERCPU_ARRAY</td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;">BPF_MAP_TYPE_BLOOM_FILTER</td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;">BPF_MAP_TYPE_CGROUP_STORAGE</td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;">BPF_MAP_TYPE_CGRP_STORAGE</td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;">BPF_MAP_TYPE_CPUMAP</td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;">BPF_MAP_TYPE_DEVMAP</td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;">BPF_MAP_TYPE_DEVMAP_HASH</td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;">BPF_MAP_TYPE_HASH</td><td style="text-align:center;">\u54C8\u5E0C\u8868\u6620\u5C04\uFF0C\u7528\u4E8E\u4FDD\u5B58 key/value \u5BF9</td></tr><tr><td style="text-align:center;">BPF_MAP_TYPE_PERCPU_HASH</td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;">BPF_MAP_TYPE_LRU_HASH</td><td style="text-align:center;">\u54C8\u5E0C\u8868\uFF0C\u62E5\u6709 LRU \u529F\u80FD</td></tr><tr><td style="text-align:center;">BPF_MAP_TYPE_LPM_TRIE</td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;">BPF_MAP_TYPE_ARRAY_OF_MAPS</td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;">BPF_MAP_TYPE_HASH_OF_MAPS</td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;">BPF_MAP_TYPE_QUEUE</td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;">BPF_MAP_TYPE_STACK</td><td style="text-align:center;">\u8C03\u7528\u6808\u8DDF\u8E2A\u6620\u5C04\uFF0C\u7528\u4E8E\u5B58\u50A8\u8C03\u8BD5\u6808\u4FE1\u606F</td></tr><tr><td style="text-align:center;">BPF_MAP_TYPE_SK_STORAGE</td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;">BPF_MAP_TYPE_SOCKMAP</td><td style="text-align:center;">\u5957\u63A5\u5B57\u6620\u5C04\uFF0C\u7528\u4E8E\u5B58\u50A8\u5957\u63A5\u5B57\u5F15\u7528\uFF0C\u7279\u522B\u662F\u7528\u4E8E\u5957\u63A5\u5B57\u7684\u91CD\u5B9A\u5411</td></tr><tr><td style="text-align:center;">BPF_MAP_TYPE_SOCKHASH</td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;">BPF_MAP_TYPE_XSKMAP</td><td style="text-align:center;"></td></tr></tbody></table><h2 id="\u5B9A\u4E49\u4E00\u4E2A-maps" tabindex="-1">\u5B9A\u4E49\u4E00\u4E2A maps <a class="header-anchor" href="#\u5B9A\u4E49\u4E00\u4E2A-maps" aria-hidden="true">#</a></h2><div class="language-c line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">struct</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">__uint</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">type</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> BPF_MAP_TYPE_ARRAY</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">__type</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">key</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> u32</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">__type</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">value</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">long</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">__uint</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">max_entries</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">256</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> my_map </span><span style="color:#82AAFF;">SEC</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">.mpas</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="\u76F8\u5173\u51FD\u6570" tabindex="-1">\u76F8\u5173\u51FD\u6570 <a class="header-anchor" href="#\u76F8\u5173\u51FD\u6570" aria-hidden="true">#</a></h2><ul><li>bpf_map_lookup_elem(&amp;my_map, &amp;index) \u4ECE map \u4E2D\u67E5\u627E\u4E00\u4E2A\u5143\u7D20</li><li>__sync_fetch_and_add(value, 1) \u539F\u5B50\u81EA\u589E 1</li><li>bpf_map_update_elem\uFF08&amp;my_map, &amp;index, &amp;value, BPF_ANY) \u66F4\u65B0\u6570\u503C</li><li>long bpf_map_delete_elem(struct bpf_map *map, const void *key) \u5220\u9664\u5143\u7D20</li></ul><h2 id="\u904D\u5386-maps" tabindex="-1">\u904D\u5386 maps <a class="header-anchor" href="#\u904D\u5386-maps" aria-hidden="true">#</a></h2><ul><li>\u904D\u5386 maps \u6709\u70B9\u610F\u601D\uFF0C\u8D77\u5230\u5173\u952E\u7684\u5C31\u662F <code>next_key</code><ul><li>bpf_map_get_next_key \u901A\u8FC7\u4E00\u4E2A<code>null key</code>\u83B7\u53D6 next_key\uFF0C\u6307\u9488\u53D6\u5730\u5740</li><li>bpf_map_lookup_elem \u67E5\u627E\u5143\u7D20</li><li>\u5C06 next_key \u8D4B\u503C\u7ED9\u5F53\u524D key\u3002</li></ul></li><li>\u7528\u8D77\u6765\u5176\u5B83\u7684\u8BED\u8A00\u65B9\u4FBF</li></ul><div class="language-c line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">#include</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">bpf/libbpf.h</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">#include</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">bpf/bpf.h</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">walk_hash_elements</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">map_fd</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">struct</span><span style="color:#F07178;"> key </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;">cur_key </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">NULL;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">struct</span><span style="color:#F07178;"> key next_key</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">struct</span><span style="color:#F07178;"> value value</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">int</span><span style="color:#F07178;"> err</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">for</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(;;)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        err </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">bpf_map_get_next_key</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">map_fd</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> cur_key</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#F07178;">next_key</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">err</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;">break</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">bpf_map_lookup_elem</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">map_fd</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#F07178;">next_key</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#F07178;">value</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// Use key and value here</span></span>
<span class="line"><span style="color:#F07178;">        cur_key </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#F07178;">next_key</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="\u53C2\u8003" tabindex="-1">\u53C2\u8003 <a class="header-anchor" href="#\u53C2\u8003" aria-hidden="true">#</a></h2><ul><li><a href="https://docs.kernel.org/bpf/map_array.html" target="_blank" rel="noreferrer">https://docs.kernel.org/bpf/map_array.html</a></li></ul>`,11),p=[t];function r(o,c,y,F,i,_){return a(),n("div",null,p)}const m=s(e,[["render",r]]);export{D as __pageData,m as default};
