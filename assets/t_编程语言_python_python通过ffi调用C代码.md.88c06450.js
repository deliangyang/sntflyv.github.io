import{_ as l,r as p,c as e,e as o,b as s,d as n,a as r,o as c}from"./app.0ce55433.js";const E=JSON.parse('{"title":"Python \u901A\u8FC7 FFI \u8C03\u7528 C/C++ \u4EE3\u7801","description":"","frontmatter":{},"headers":[{"level":2,"title":"\u7F16\u5199 C \u8BED\u8A00\u63A5\u53E3","slug":"\u7F16\u5199-c-\u8BED\u8A00\u63A5\u53E3","link":"#\u7F16\u5199-c-\u8BED\u8A00\u63A5\u53E3","children":[]},{"level":2,"title":"\u7F16\u5199 Python \u7A0B\u5E8F\u8C03\u7528\u52A8\u6001\u94FE\u63A5\u5E93","slug":"\u7F16\u5199-python-\u7A0B\u5E8F\u8C03\u7528\u52A8\u6001\u94FE\u63A5\u5E93","link":"#\u7F16\u5199-python-\u7A0B\u5E8F\u8C03\u7528\u52A8\u6001\u94FE\u63A5\u5E93","children":[]},{"level":2,"title":"\u4EE3\u7801\u7F16\u8BD1\u53CA\u6267\u884C","slug":"\u4EE3\u7801\u7F16\u8BD1\u53CA\u6267\u884C","link":"#\u4EE3\u7801\u7F16\u8BD1\u53CA\u6267\u884C","children":[]}],"relativePath":"t/\u7F16\u7A0B\u8BED\u8A00/python/python\u901A\u8FC7ffi\u8C03\u7528C\u4EE3\u7801.md","lastUpdated":1729589704000}'),t={name:"t/\u7F16\u7A0B\u8BED\u8A00/python/python\u901A\u8FC7ffi\u8C03\u7528C\u4EE3\u7801.md"},i=s("h1",{id:"python-\u901A\u8FC7-ffi-\u8C03\u7528-c-c-\u4EE3\u7801",tabindex:"-1"},[n("Python \u901A\u8FC7 FFI \u8C03\u7528 C/C++ \u4EE3\u7801 "),s("a",{class:"header-anchor",href:"#python-\u901A\u8FC7-ffi-\u8C03\u7528-c-c-\u4EE3\u7801","aria-hidden":"true"},"#")],-1),F=s("h1",{id:"\u52A8\u6001\u94FE\u63A5\u5E93\u8C03\u7528",tabindex:"-1"},[n("\u52A8\u6001\u94FE\u63A5\u5E93\u8C03\u7528 "),s("a",{class:"header-anchor",href:"#\u52A8\u6001\u94FE\u63A5\u5E93\u8C03\u7528","aria-hidden":"true"},"#")],-1),y=s("p",null,"\u786E\u5B9A\u51FD\u6570\u58F0\u660E\u548C ABI\uFF08\u4E8C\u8FDB\u5236\u63A5\u53E3\uFF09\uFF0C\u5C31\u80FD\u591F\u786E\u5B9A\u53C2\u6570\u548C\u8FD4\u56DE\u503C\u7684\u4F20\u9012\u65B9\u5F0F\u3002",-1),D=s("p",null,"FFI \u7684\u4F20\u9012\u65B9\u5F0F\u662F\u57FA\u4E8E\u51FD\u6570\u58F0\u660E\u548C ABI \u7684\u56FA\u5B9A\u4E0D\u53D8\u7684\u4E1C\u897F\uFF0C\u518D\u52A0\u4E0A\u80FD\u591F\u53D8\u5316\u7684 \u51FD\u6570\u5730\u5740\u3001\u6570\u636E\uFF0C\u5C31\u53EF\u4EE5\u8C03\u7528\u8FD9\u4E2A\u51FD\u6570\u3002",-1),A=r(`<h2 id="\u7F16\u5199-c-\u8BED\u8A00\u63A5\u53E3" tabindex="-1">\u7F16\u5199 C \u8BED\u8A00\u63A5\u53E3 <a class="header-anchor" href="#\u7F16\u5199-c-\u8BED\u8A00\u63A5\u53E3" aria-hidden="true">#</a></h2><div class="language-c line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;">// ffi_test.cpp</span></span>
<span class="line"><span style="color:#C792EA;">extern</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">C</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">add</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">a</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">b</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">add</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">a</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">b</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> a </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> b</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="\u7F16\u5199-python-\u7A0B\u5E8F\u8C03\u7528\u52A8\u6001\u94FE\u63A5\u5E93" tabindex="-1">\u7F16\u5199 Python \u7A0B\u5E8F\u8C03\u7528\u52A8\u6001\u94FE\u63A5\u5E93 <a class="header-anchor" href="#\u7F16\u5199-python-\u7A0B\u5E8F\u8C03\u7528\u52A8\u6001\u94FE\u63A5\u5E93" aria-hidden="true">#</a></h2><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;"># test_ffi.py</span></span>
<span class="line"><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> cffi </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> FFI</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">ffi </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">FFI</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">ffi</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cdef</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#C3E88D;">  int add(int a, int b);</span></span>
<span class="line"><span style="color:#89DDFF;">&quot;&quot;&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">lib </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> ffi</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">dlopen</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">libffi_test.so</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">lib</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">4</span><span style="color:#89DDFF;">))</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="\u4EE3\u7801\u7F16\u8BD1\u53CA\u6267\u884C" tabindex="-1">\u4EE3\u7801\u7F16\u8BD1\u53CA\u6267\u884C <a class="header-anchor" href="#\u4EE3\u7801\u7F16\u8BD1\u53CA\u6267\u884C" aria-hidden="true">#</a></h2><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">g++ ffi_test.cpp -fPIC -shared -o libffi_test.so</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">python test_ffi.py</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># output: 7</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h1 id="python-\u4EE3\u7801\u4E2D\u5D4C\u5165-c-\u4EE3\u7801" tabindex="-1">Python \u4EE3\u7801\u4E2D\u5D4C\u5165 C \u4EE3\u7801 <a class="header-anchor" href="#python-\u4EE3\u7801\u4E2D\u5D4C\u5165-c-\u4EE3\u7801" aria-hidden="true">#</a></h1><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> cffi </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> FFI</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">ffi </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">FFI</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">ffi</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cdef</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#C3E88D;">  int add(int a, int b);</span></span>
<span class="line"><span style="color:#89DDFF;">&quot;&quot;&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">lib </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> ffi</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">verify</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#C3E88D;">  int add(int a,int b){</span></span>
<span class="line"><span style="color:#C3E88D;">    return a+b;</span></span>
<span class="line"><span style="color:#C3E88D;">  }</span></span>
<span class="line"><span style="color:#89DDFF;">&quot;&quot;&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">lib</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">4</span><span style="color:#89DDFF;">))</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h1 id="\u603B\u7ED3" tabindex="-1">\u603B\u7ED3 <a class="header-anchor" href="#\u603B\u7ED3" aria-hidden="true">#</a></h1><p>\u901A\u8FC7 FFI \u6211\u4EEC\u53EF\u4EE5\u8F7B\u677E\u7684\u5728 Python \u4E2D\u5D4C\u5165 C/C++ \u8BED\u8A00\u4EE3\u7801\uFF0C\u4ECE\u800C\u907F\u514D\u5728 C/C++ \u7E41\u7410\u7684\u7F16\u8BD1\u5DE5\u5177\u94FE\u8017\u8D39\u5927\u91CF\u7684\u65F6\u95F4\uFF0C\u51CF\u5C11\u5F00\u53D1\u6210\u672C\u3002</p><p>\u8C03\u7528\u52A8\u6001\u94FE\u63A5\u5E93\uFF0C\u65B9\u4FBF\u6211\u4EEC\u8DE8\u8BED\u8A00\u590D\u7528\u4EE3\u7801\u5E93\uFF0C\u4E0D\u9700\u8981\u5728\u5F53\u524D\u8BED\u8A00\u7684\u57FA\u7840\u4E0A\u518D\u5B9E\u73B0\u4E00\u6B21\u3002</p><p>FFI \u652F\u6301 CPython\u3001Ruby\u3001Rust\u3001Nodejs\u3001PHP\u3001Java \u7B49\uFF0C\u652F\u6301\u5927\u90E8\u5206\u7684\u7CFB\u7EDF\u67B6\u6784\u548C\u64CD\u4F5C\u7CFB\u7EDF\uFF0CX86\u3001X86-64\u3001PowerPC\u3001ARM\u3001AArch64 \u7B49\u3002</p>`,12);function d(C,b,u,f,h,_){const a=p("Mermaid");return c(),e("div",null,[i,F,y,D,o(a,{id:"mermaid_382ee147",graph:"graph%20TD%3B%0A%20%20%20%20ABI(%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%8E%A5%E5%8F%A3ABI)--%3Effi_prep_cif(ffi_prep_cif)%3B%0A%20%20%20%20func_no(%E5%87%BD%E6%95%B0%E5%A3%B0%E6%98%8E)--%3Effi_prep_cif%3B%0A%20%20%20%20ffi_prep_cif--%3Effi_cif(ffi_cif)%0A%20%20%20%20ffi_cif--%3Effi_call%3B%0A%20%20%20%20return_addr(%E8%BF%94%E5%9B%9E%E5%80%BC%E5%9C%B0%E5%9D%80)--%3Effi_call%3B%0A%20%20%20%20args_list(%E5%8F%82%E6%95%B0%E6%95%B0%E6%8D%AE%E6%95%B0%E7%BB%84)--%3Effi_call%3B%0A%20%20%20%20func_addr(%E5%87%BD%E6%95%B0%E5%9C%B0%E5%9D%80)--%3Effi_call(ffi_call)%3B"}),A])}const B=l(t,[["render",d]]);export{E as __pageData,B as default};
